---
description: 
globs: 
alwaysApply: false
---
---
description: "Enforce standards for miner curation of prospects from the Prospect Pool."
globs:
  - "neurons/miner.py"
  - "Leadpoet/base/miner.py"
  - "Leadpoet/api/leadpoet_api.py"
alwaysApply: true
---

# Miner Curation Standards

Miners curate prospect lists from the Prospect Pool in response to buyer ICP queries. The following standards ensure compliance:

## Curation Logic
- Query `prospects` table using buyer’s ICP criteria (`industry`, `region`) via Supabase client.
- Select prospects with `conversion_score > 0.1` to maximize relevance.
- Return a list of up to 50 prospects (configurable) per query.
- Implement commit-reveal mechanism:
  - Compute `commit_hash` (SHA-256) of curated list.
  - Submit `commit_hash` to `curated_lists` table with `submission_timestamp`.
  - Reveal curated list (`prospect_ids`) within 20 seconds, updating `reveal_timestamp`.

## API Integration
- Handle buyer queries via `Leadpoet.api.leadpoet_api.get_leads`:
  - Input: `num_leads`, `industry`, `region`.
  - Output: Curated list of `prospect_ids`.
- Miners are selected via `get_query_api_axons` based on stake and responsiveness.
- Store curated lists in `curated_lists` table with `query_id`, `miner_uid`, and `prospect_ids`.

## Incentive Tracking
- Track `Iₘ(t)` (number of curated prospects in Final Curated Lists) by querying `curated_lists` and `scores`.
- Compute `Jₘ(t)` (average Conversion Score of curated prospects) from `scores` table.
- Calculate Curating Score: `Hₘ(t) = (Iₘ(t) * Jₘ(t)) / (∑ₘ (Iₘ(t) * Jₘ(t)))`.
- Weighted Curating Score: `Kₘ = 0.55 * Hₘ(last 14 days) + 0.25 * Hₘ(last 30 days) + 0.20 * Hₘ(last 90 days)`.

## Security
- Validate buyer API keys and Bittensor hotkeys before processing queries.
- Ensure `commit_hash` matches revealed list to prevent tampering.
- Log curation attempts and failures (e.g., timeout, invalid criteria).

## Testing
- Write unit tests (`tests/miner_curation_tests.py`) mocking Supabase queries and commit-reveal logic.
- Test commit-reveal timing (must be <20s) and hash integrity.
- Ensure >90% coverage for curation logic.